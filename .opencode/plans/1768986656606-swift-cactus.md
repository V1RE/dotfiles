# Plan: Integrate opencode.nvim

## Overview

Integrate [NickvanDyke/opencode.nvim](https://github.com/NickvanDyke/opencode.nvim) - a Neovim plugin that connects to the opencode AI assistant, enabling editor-aware prompts with context injection.

## Key Compatibility Points

- `snacks.nvim` with `input`, `picker` enabled (for ask/select UI)
- `lualine.nvim` for statusline integration
- **wezterm** as terminal - opencode runs in wezterm pane (outside nvim)

## Implementation Steps

### 1. Create Plugin File

**File:** `dot_config/nvim/exact_lua/core/exact_plugins/opencode.lua`

```lua
---@type LazyPluginSpec
return {
  "NickvanDyke/opencode.nvim",
  dependencies = { "folke/snacks.nvim" },
  event = "VeryLazy",
  config = function()
    ---@type opencode.Opts
    vim.g.opencode_opts = {
      provider = {
        enabled = "wezterm",
        wezterm = {
          direction = "right",  -- opens pane to the right of nvim
          percent = 35,         -- 35% width
        },
      },
    }
    vim.o.autoread = true  -- required for buffer reload on edits
  end,
  keys = {
    { "<leader>oa", function() require("opencode").ask("@this: ", { submit = true }) end, mode = { "n", "x" }, desc = "Ask opencode" },
    { "<leader>os", function() require("opencode").select() end, mode = { "n", "x" }, desc = "Select opencode action" },
    { "<leader>oo", function() require("opencode").toggle() end, mode = { "n", "t" }, desc = "Toggle opencode" },
    { "go", function() return require("opencode").operator("@this ") end, mode = { "n", "x" }, desc = "Add range to opencode", expr = true },
    { "goo", function() return require("opencode").operator("@this ") .. "_" end, desc = "Add line to opencode", expr = true },
  },
}
```

### 2. Add Statusline Component

**File:** `dot_config/nvim/exact_lua/core/exact_plugins/lualine.lua`

Add to `lualine_x` section (after noice components, ~line 172):

```lua
{
  function() return require("opencode").statusline() end,
  cond = function()
    local ok, opencode = pcall(require, "opencode")
    return ok and opencode.statusline() ~= ""
  end,
},
```

## Keybinding Summary

| Binding | Mode | Action |
|---------|------|--------|
| `<leader>oo` | n, t | Toggle opencode wezterm pane |
| `<leader>oa` | n, x | Ask opencode with context |
| `<leader>os` | n, x | Select action/prompt |
| `go{motion}` | n | Add range to opencode |
| `goo` | n | Add current line |

## Verification

1. `:checkhealth opencode` - verify setup
2. `<leader>oo` - opens opencode in wezterm pane to the right
3. Select text, `<leader>oa` - test context injection
4. Check lualine shows opencode status when connected

## Notes

- **wezterm provider**: runs opencode in a wezterm pane (not nvim terminal)
- Benefits: native wezterm scrollback, better performance, independent of nvim
- Uses your existing wezterm pane splitting (`LEADER+l` style)
- Pairs well with `CTRL+h/l` pane navigation you already have
